name: Dependency Submission

on:
  push:
    branches:
      - main
      - develop
    paths:
      - 'package.json'
      - 'package-lock.json'
      - 'requirements.txt'
      - 'requirements_chimera.txt'
  schedule:
    # Run daily to keep dependency graph updated
    - cron: '0 6 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: read

jobs:
  submit-npm-dependencies:
    name: Submit NPM Dependencies
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Submit dependency snapshot
        uses: advanced-security/maven-dependency-submission-action@v4
        continue-on-error: true
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Submit NPM dependencies using npm-dependency-submission
        uses: actions/dependency-submission/npm@v1
        continue-on-error: true

  submit-python-dependencies:
    name: Submit Python Dependencies
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Submit Python dependency graph
        uses: actions/dependency-submission/python@v1
        continue-on-error: true
        with:
          requirements-files: |
            requirements.txt
            requirements_chimera.txt

  dependency-graph-status:
    name: Check Dependency Graph Status
    runs-on: ubuntu-latest
    needs: [submit-npm-dependencies, submit-python-dependencies]
    permissions:
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Report submission status
        run: |
          echo "âœ… Dependency submission completed"
          echo "ðŸ“Š Dependencies submitted to GitHub dependency graph"
          echo "ðŸ”’ Dependabot will now monitor for vulnerabilities"
          echo "ðŸ¤– Autonomous monitoring active under user: oconnorw225-del"
          echo ""
          echo "Visit the following URLs to view:"
          echo "- Dependency Graph: https://github.com/${{ github.repository }}/network/dependencies"
          echo "- Dependabot Alerts: https://github.com/${{ github.repository }}/security/dependabot"
          echo "- Security Overview: https://github.com/${{ github.repository }}/security"
